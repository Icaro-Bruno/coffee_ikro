<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>PÃ¡gina Do Produto</title>
    <link rel="stylesheet" th:href="@{/pagprod.css}">
    <link href="https://fonts.googleapis.com/css2?family=Merienda:wght@300..900&display=swap" rel="stylesheet">
</head>
<body>

<header class="cabecalho">
    <button id="menu-toggle">â˜°</button>

    <a id="carrinho" href="/carrinho" style="text-decoration: none; color: inherit;">
        ðŸ›’ <span id="carrinho-count">0</span>
    </a>

</header>

<nav id="menu" class="hidden">
    <div class="menu-content">
        <ul>
            <li><a href="#">Pedir Via Whatsapp</a></li>
            <li><a href="#">PromoÃ§Ãµes</a></li>
        </ul>
    </div>
</nav>

<section class="produto-container">
    <h1 th:text="${pagProduto.nome}" class="produto-nome">Nome do Produto</h1>

    <img th:src="${pagProduto.imgUrl}" alt="Imagem do Produto" class="produto-img">

    <span id="preco-unitario" th:data-preco="${pagProduto.preco}" style="display:none;"></span>
</section>

<main class="produto-descricao">
    <h2>DescriÃ§Ã£o</h2>
    <p th:text="${pagProduto.descricao}">Descricao</p>
</main>

<footer class="produto-footer-fixo">
    <div class="controle-quantidade">
        <button id="menos">-</button>
        <input type="text" id="quantidade" value="1" readonly>
        <button id="mais">+</button>
    </div>

    <button id="botao-adicionar" class="botao-adicionar">
        R$ 0,00 | Adicionar ao carrinho
    </button>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menosBtn = document.getElementById('menos');
        const maisBtn = document.getElementById('mais');
        const quantidadeInput = document.getElementById('quantidade');
        const precoUnitarioSpan = document.getElementById('preco-unitario');
        const botaoAdicionar = document.getElementById('botao-adicionar');
        const carrinhoCount = document.getElementById('carrinho-count');

        function atualizarPrecoTotal() {
            const precoUnitario = parseFloat(precoUnitarioSpan.dataset.preco || 0);
            const quantidade = parseInt(quantidadeInput.value);
            const total = (precoUnitario * quantidade).toFixed(2).replace('.', ',');
            botaoAdicionar.innerText = `R$ ${total} | Adicionar ao carrinho`;
        }

        function modificarQuantidade(modificador) {
            let valor = parseInt(quantidadeInput.value);
            if (valor + modificador >= 1) {
                quantidadeInput.value = valor + modificador;
                atualizarPrecoTotal();
            }
        }

        menosBtn.addEventListener('click', () => modificarQuantidade(-1));
        maisBtn.addEventListener('click', () => modificarQuantidade(1));

        function obterCarrinho() {
            return JSON.parse(localStorage.getItem('carrinho')) || [];
        }

        function salvarCarrinho(carrinho) {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
        }

        function atualizarContadorCarrinho() {
            const carrinho = obterCarrinho();
            const total = carrinho.reduce((soma, item) => soma + item.quantidade, 0);
            carrinhoCount.textContent = total;
        }

        botaoAdicionar.addEventListener('click', () => {
            const nome = document.querySelector('.produto-nome').innerText;
            const preco = parseFloat(precoUnitarioSpan.dataset.preco);
            const img = document.querySelector('.produto-img').getAttribute('src');
            const quantidade = parseInt(quantidadeInput.value);

            if (!nome || !preco || !img || !quantidade) {
                alert("Erro ao adicionar item. Verifique os dados.");
                return;
            }

            let carrinho = obterCarrinho();
            const produtoExistente = carrinho.find(item => item.nome === nome);

            produtoExistente ? produtoExistente.quantidade += quantidade : carrinho.push({ nome, preco, img, quantidade });

            salvarCarrinho(carrinho);
            atualizarContadorCarrinho();
            alert("Produto adicionado ao carrinho!");
        });

        atualizarPrecoTotal();
        atualizarContadorCarrinho();
    });
</script>

</body>
</html>
