<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Página Do Produto</title>
    <link rel="stylesheet" th:href="@{/pagprod.css}">
    <link rel="stylesheet" th:href="@{/header.css}">
    <link href="https://fonts.googleapis.com/css2?family=Merienda:wght@300..900&display=swap" rel="stylesheet">
</head>
<body>

<div th:replace="header :: body"></div>

<section class="produto-container">
    <h1 th:text="${pagProduto.nome}" class="produto-nome">Nome do Produto</h1>

    <img th:src="${pagProduto.imgUrl}" alt="Imagem do Produto" class="produto-img">

    <span id="preco-unitario" th:data-preco="${pagProduto.preco}" style="display:none;"></span>
</section>

<main class="produto-descricao">
    <h2>Descrição</h2>
    <p th:text="${pagProduto.descricao}">Descricao</p>
</main>

<footer class="produto-footer-fixo">
    <div class="controle-quantidade">
        <button id="menos">-</button>
        <input type="text" id="quantidade" value="1" readonly>
        <button id="mais">+</button>
    </div>

    <button id="botao-adicionar" class="botao-adicionar">
        R$ 0,00 | Adicionar ao carrinho
    </button>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menosBtn = document.getElementById('menos');
        const maisBtn = document.getElementById('mais');
        const quantidadeInput = document.getElementById('quantidade');
        const precoUnitarioSpan = document.getElementById('preco-unitario');
        const botaoAdicionar = document.getElementById('botao-adicionar');

        function atualizarPrecoTotal() {
            const precoUnitario = parseFloat(precoUnitarioSpan.dataset.preco || 0);
            const quantidade = parseInt(quantidadeInput.value);
            const total = (precoUnitario * quantidade).toFixed(2).replace('.', ',');
            botaoAdicionar.innerText = `R$ ${total} | Adicionar ao carrinho`;
        }

        function modificarQuantidade(modificador) {
            let valor = parseInt(quantidadeInput.value);
            if (valor + modificador >= 1) {
                quantidadeInput.value = valor + modificador;
                atualizarPrecoTotal();
            }
        }

        menosBtn.addEventListener('click', () => modificarQuantidade(-1));
        maisBtn.addEventListener('click', () => modificarQuantidade(1));

        botaoAdicionar.addEventListener('click', () => {
            const nome = document.querySelector('.produto-nome').innerText;
            const preco = parseFloat(precoUnitarioSpan.dataset.preco);
            const img = document.querySelector('.produto-img').getAttribute('src');
            const quantidade = parseInt(quantidadeInput.value);

            if (!nome || !preco || !img || !quantidade) {
                alert("Erro ao adicionar item. Verifique os dados.");
                return;
            }

            let carrinho = window.obterCarrinho();
            const produtoExistente = carrinho.find(item => item.nome === nome);

            produtoExistente ? produtoExistente.quantidade += quantidade : carrinho.push({ nome, preco, img, quantidade });

            window.salvarCarrinho(carrinho);
            window.atualizarContadorCarrinho();
            alert("Produto adicionado ao carrinho!");
        });

        atualizarPrecoTotal();
        window.atualizarContadorCarrinho();
    });
</script>


<script th:src="@{/js/header.js}"></script>

</body>
</html>
